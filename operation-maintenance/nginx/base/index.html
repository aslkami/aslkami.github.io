<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta name="keywords" content="dumi, umijs, aslkami, 安了个装, 樂下独舞" />
    <meta name="description" content="dumi, 记录个人js知识点" />
    <link rel="shortcut icon" type="image/x-icon" href="/images/hunter.jpeg" />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.5.37
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>Nginx 基础 - 安了个装</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/operation-maintenance/nginx/base" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/images/hunter.jpeg&#x27;)" href="/">安了个装</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/base">基础</a></span><span><a href="/node">Node</a><ul><li><a href="/node/base">Node 基础</a></li><li><a href="/node/promise">Promise</a></li></ul></span><span><a aria-current="page" class="active" href="/operation-maintenance">前端运维</a></span><span><a href="/pack-tool">前端工程化</a></span><span><a href="/react">React</a></span><span><a href="/css">CSS</a></span><span><a href="/question">问题汇总</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://aslkami-vue.netlify.app/">Vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><span>隐秘的角落<ul><li><a target="_blank" rel="noopener noreferrer" href="https://aslkami.gatsbyjs.io">gatsby 博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://aslkami.netlify.app">hexo 博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/fund">基金学习</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/536217405113208">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/aslkami/aslkami.github.io">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/images/hunter.jpeg&#x27;)" href="/"></a><h1>安了个装</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/base">基础</a></li><li><a href="/node">Node</a><ul><li><a href="/node/base">Node 基础</a></li><li><a href="/node/promise">Promise</a></li></ul></li><li><a aria-current="page" class="active" href="/operation-maintenance">前端运维</a></li><li><a href="/pack-tool">前端工程化</a></li><li><a href="/react">React</a></li><li><a href="/css">CSS</a></li><li><a href="/question">问题汇总</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://aslkami-vue.netlify.app/">Vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>隐秘的角落<ul><li><a target="_blank" rel="noopener noreferrer" href="https://aslkami.gatsbyjs.io">gatsby 博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://aslkami.netlify.app">hexo 博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/fund">基金学习</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/536217405113208">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/aslkami/aslkami.github.io">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/operation-maintenance/cicd">CICD</a><ul><li><a href="/operation-maintenance/cicd"><span>持续集成</span></a></li></ul></li><li><a href="/operation-maintenance/docker">Docker</a><ul><li><a href="/operation-maintenance/docker/introduce"><span>Docker 介绍</span></a></li><li><a href="/operation-maintenance/docker/base"><span>Docker 基础</span></a></li><li><a href="/operation-maintenance/docker/advance"><span>Docker 进阶</span></a></li><li><a href="/operation-maintenance/docker/project"><span>Node 项目</span></a></li></ul></li><li><a href="/operation-maintenance/k8s">K8S</a><ul><li><a href="/operation-maintenance/k8s"><span>k8s 入门</span></a></li><li><a href="/operation-maintenance/k8s/base"><span>k8s 基础</span></a></li><li><a href="/operation-maintenance/k8s/advance"><span>k8s 进阶</span></a></li><li><a href="/operation-maintenance/k8s/project"><span>项目实战</span></a></li></ul></li><li><a href="/operation-maintenance/linux">Linux</a><ul><li><a href="/operation-maintenance/linux"><span>基础</span></a></li><li><a href="/operation-maintenance/linux/vi-editor"><span>Vi 编辑器</span></a></li><li><a href="/operation-maintenance/linux/user-group"><span>用户和用户组</span></a></li><li><a href="/operation-maintenance/linux/auth"><span>权限</span></a></li><li><a href="/operation-maintenance/linux/shell"><span>Shell</span></a></li><li><a href="/operation-maintenance/linux/package-manage"><span>服务与包管理</span></a></li><li><a href="/operation-maintenance/linux/system"><span>linux 进程</span></a></li><li><a href="/operation-maintenance/linux/network"><span>网络</span></a></li><li><a href="/operation-maintenance/linux/install"><span>常用软件安装</span></a></li></ul></li><li><a aria-current="page" class="active" href="/operation-maintenance/nginx">Nginx</a><ul><li><a href="/operation-maintenance/nginx/introduce"><span>Nginx 介绍</span></a></li><li><a aria-current="page" class="active" href="/operation-maintenance/nginx/base"><span>Nginx 基础</span></a></li><li><a href="/operation-maintenance/nginx/advance"><span>Nginx 进阶</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="nginx安装" data-depth="2"><a href="/operation-maintenance/nginx/base#nginx安装"><span>nginx安装</span></a></li><li title="版本分类" data-depth="3"><a href="/operation-maintenance/nginx/base#版本分类"><span>版本分类</span></a></li><li title="下载地址" data-depth="3"><a href="/operation-maintenance/nginx/base#下载地址"><span>下载地址</span></a></li><li title="CentOS下YUM安装" data-depth="3"><a href="/operation-maintenance/nginx/base#centos下yum安装"><span>CentOS下YUM安装</span></a></li><li title="目录" data-depth="2"><a href="/operation-maintenance/nginx/base#目录"><span>目录</span></a></li><li title="安装目录" data-depth="3"><a href="/operation-maintenance/nginx/base#安装目录"><span>安装目录</span></a></li><li title="日志切割文件" data-depth="3"><a href="/operation-maintenance/nginx/base#日志切割文件"><span>日志切割文件</span></a></li><li title="主配置文件" data-depth="3"><a href="/operation-maintenance/nginx/base#主配置文件"><span>主配置文件</span></a></li><li title="守护进程管理" data-depth="3"><a href="/operation-maintenance/nginx/base#守护进程管理"><span>守护进程管理</span></a></li><li title="nginx模块目录" data-depth="3"><a href="/operation-maintenance/nginx/base#nginx模块目录"><span>nginx模块目录</span></a></li><li title="文档" data-depth="3"><a href="/operation-maintenance/nginx/base#文档"><span>文档</span></a></li><li title="缓存目录" data-depth="3"><a href="/operation-maintenance/nginx/base#缓存目录"><span>缓存目录</span></a></li><li title="日志目录" data-depth="3"><a href="/operation-maintenance/nginx/base#日志目录"><span>日志目录</span></a></li><li title="可执行命令" data-depth="3"><a href="/operation-maintenance/nginx/base#可执行命令"><span>可执行命令</span></a></li><li title="编译参数" data-depth="2"><a href="/operation-maintenance/nginx/base#编译参数"><span>编译参数</span></a></li><li title="安装目录和路径" data-depth="3"><a href="/operation-maintenance/nginx/base#安装目录和路径"><span>安装目录和路径</span></a></li><li title="指定用户" data-depth="3"><a href="/operation-maintenance/nginx/base#指定用户"><span>指定用户</span></a></li><li title="配置文件" data-depth="2"><a href="/operation-maintenance/nginx/base#配置文件"><span>配置文件</span></a></li><li title="nginx配置语法" data-depth="3"><a href="/operation-maintenance/nginx/base#nginx配置语法"><span>nginx配置语法</span></a></li><li title="全局配置" data-depth="3"><a href="/operation-maintenance/nginx/base#全局配置"><span>全局配置</span></a></li><li title="事件配置" data-depth="3"><a href="/operation-maintenance/nginx/base#事件配置"><span>事件配置</span></a></li><li title="http配置" data-depth="3"><a href="/operation-maintenance/nginx/base#http配置"><span>http配置</span></a></li><li title="server" data-depth="3"><a href="/operation-maintenance/nginx/base#server"><span>server</span></a></li><li title="Systemd" data-depth="3"><a href="/operation-maintenance/nginx/base#systemd"><span>Systemd</span></a></li><li title="启动和重新加载" data-depth="3"><a href="/operation-maintenance/nginx/base#启动和重新加载"><span>启动和重新加载</span></a></li><li title="日志" data-depth="3"><a href="/operation-maintenance/nginx/base#日志"><span>日志</span></a></li><li title="nginx工作流" data-depth="2"><a href="/operation-maintenance/nginx/base#nginx工作流"><span>nginx工作流</span></a></li><li title="配置块" data-depth="3"><a href="/operation-maintenance/nginx/base#配置块"><span>配置块</span></a></li><li title="值指令继承规则" data-depth="3"><a href="/operation-maintenance/nginx/base#值指令继承规则"><span>值指令继承规则</span></a></li><li title="server匹配" data-depth="3"><a href="/operation-maintenance/nginx/base#server匹配"><span>server匹配</span></a></li><li title="HTTP请求处理" data-depth="3"><a href="/operation-maintenance/nginx/base#http请求处理"><span>HTTP请求处理</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h2 id="nginx安装"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#nginx安装"><span class="icon icon-link"></span></a><code>nginx安装</code></h2><h3 id="版本分类"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#版本分类"><span class="icon icon-link"></span></a><code>版本分类</code></h3><ul><li>Mainline version 开发版</li><li>Stable version 稳定版</li><li>Legacy versions 历史版本</li></ul><h3 id="下载地址"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#下载地址"><span class="icon icon-link"></span></a><code>下载地址</code></h3><p><a target="_blank" rel="noopener noreferrer" href="http://nginx.org/en/download.html">nginx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a target="_blank" rel="noopener noreferrer" href="http://nginx.org/en/linux_packages.html#stable">linux_packages<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h3 id="centos下yum安装"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#centos下yum安装"><span class="icon icon-link"></span></a><code>CentOS下YUM安装</code></h3><ul><li>vi /etc/yum.repos.d/nginx.repo</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">[</span><span class="token plain">nginx</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token plain">nginx repo</span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">baseurl</span><span class="token operator">=</span><span class="token plain">http://nginx.org/packages/centos/7/</span><span class="token variable">$basearch</span><span class="token plain">/</span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">yum </span><span class="token function">install</span><span class="token plain"> nginx -y </span><span class="token comment"># 安装nginx</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">nginx -v </span><span class="token comment"># 查看安装的版本</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">nginx -V </span><span class="token comment"># 查看编译时的参数</span></div></pre></div><h2 id="目录"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#目录"><span class="icon icon-link"></span></a><code>目录</code></h2><h3 id="安装目录"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#安装目录"><span class="icon icon-link"></span></a><code>安装目录</code></h3><p>查看 nginx 安装的配置文件和目录</p><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">rpm</span><span class="token plain"> -ql nginx</span></div></pre></div><h3 id="日志切割文件"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#日志切割文件"><span class="icon icon-link"></span></a><code>日志切割文件</code></h3><p>/etc/logrotate.d/nginx</p><ul><li>对访问日志进行切割</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">/var/log/nginx/*.log </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">daily</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">ls</span><span class="token plain"> /var/log/nginx/*.log</span></div><div class="token-line"><span class="token plain">/var/log/nginx/access.log  /var/log/nginx/error.log</span></div></pre></div><h3 id="主配置文件"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#主配置文件"><span class="icon icon-link"></span></a><code>主配置文件</code></h3><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">路径</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">/etc/nginx/nginx.conf</td><td align="left">核心配置文件</td></tr><tr><td align="left">/etc/nginx/conf.d/default.conf</td><td align="left">默认 http 服务器配置文件</td></tr></tbody></table></div></div><h3 id="守护进程管理"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#守护进程管理"><span class="icon icon-link"></span></a><code>守护进程管理</code></h3><ul><li>用于配置系统守护进程管理器管理方式</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">systemctl restart nginx.service</span></div></pre></div><h3 id="nginx模块目录"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#nginx模块目录"><span class="icon icon-link"></span></a><code>nginx模块目录</code></h3><ul><li>nginx 安装的模块</li></ul><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">路径</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">/etc/nginx/modules</td><td align="left">最基本的共享库和内核模块</td></tr></tbody></table></div></div><ul><li>目的是存放用于启动系统和执行 root 文件系统的命令的如/bin 和/sbin 的二进制文件的共享库，或者存放 32 位，或者 64 位(file 命令查看)| | /usr/lib64/nginx/modules |64 位共享库|</li></ul><h3 id="文档"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#文档"><span class="icon icon-link"></span></a><code>文档</code></h3><ul><li>nginx 的手册和帮助文件</li></ul><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">路径</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">/usr/share/doc/nginx-1.14.2</td><td align="left">帮助文档</td></tr><tr><td align="left">/usr/share/doc/nginx-1.14.0/COPYRIGHT</td><td align="left">版权声明</td></tr><tr><td align="left">/usr/share/man/man8/nginx.8.gz</td><td align="left">手册</td></tr></tbody></table></div></div><h3 id="缓存目录"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#缓存目录"><span class="icon icon-link"></span></a><code>缓存目录</code></h3><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">路径</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">/var/cache/nginx</td><td align="left">nginx 的缓存目录</td></tr></tbody></table></div></div><h3 id="日志目录"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#日志目录"><span class="icon icon-link"></span></a><code>日志目录</code></h3><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">路径</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">/var/log/nginx</td><td align="left">nginx 的日志目录</td></tr></tbody></table></div></div><h3 id="可执行命令"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#可执行命令"><span class="icon icon-link"></span></a><code>可执行命令</code></h3><ul><li>nginx 服务的启动管理的可执行文件</li></ul><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">路径</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">/usr/sbin/nginx</td><td align="left">可执行命令</td></tr><tr><td align="left">/usr/sbin/nginx-debug</td><td align="left">调试执行可执行命令</td></tr></tbody></table></div></div><h2 id="编译参数"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#编译参数"><span class="icon icon-link"></span></a><code>编译参数</code></h2><h3 id="安装目录和路径"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#安装目录和路径"><span class="icon icon-link"></span></a><code>安装目录和路径</code></h3><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">--prefix</span><span class="token operator">=</span><span class="token plain">/etc/nginx </span><span class="token comment"># 安装目录</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--sbin-path</span><span class="token operator">=</span><span class="token plain">/usr/sbin/nginx </span><span class="token comment"># 可执行文件</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--modules-path</span><span class="token operator">=</span><span class="token plain">/usr/lib64/nginx/modules </span><span class="token comment"># 安装模块</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--conf-path</span><span class="token operator">=</span><span class="token plain">/etc/nginx/nginx.conf  </span><span class="token comment"># 配置文件路径</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--error-log-path</span><span class="token operator">=</span><span class="token plain">/var/log/nginx/error.log  </span><span class="token comment"># 错误日志</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--http-log-path</span><span class="token operator">=</span><span class="token plain">/var/log/nginx/access.log  </span><span class="token comment"># 访问日志</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--pid-path</span><span class="token operator">=</span><span class="token plain">/var/run/nginx.pid </span><span class="token comment"># 进程ID</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--lock-path</span><span class="token operator">=</span><span class="token plain">/var/run/nginx.lock </span><span class="token comment"># 加锁对象</span></div></pre></div><h3 id="指定用户"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#指定用户"><span class="icon icon-link"></span></a><code>指定用户</code></h3><ul><li>设置 nginx 进程启动的用户和用户组</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">--user</span><span class="token operator">=</span><span class="token plain">nginx   </span><span class="token comment"># 指定用户</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">--group</span><span class="token operator">=</span><span class="token plain">nginx  </span><span class="token comment"># 指定用户组</span></div></pre></div><h2 id="配置文件"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#配置文件"><span class="icon icon-link"></span></a><code>配置文件</code></h2><ul><li>/etc/nginx/nginx.conf #主配置文件</li><li>/etc/nginx/conf.d/*.conf #包含 conf.d 目录下面的所有配置文件</li><li>/etc/nginx/conf.d/default.conf</li></ul><h3 id="nginx配置语法"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#nginx配置语法"><span class="icon icon-link"></span></a><code>nginx配置语法</code></h3><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 使用#可以添加注释,使用$符号可以使用变量</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 配置文件由指令与指令块组成,指令块以{}将多条指令组织在一起</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">http </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># include语句允许把多个配置文件组合起来以提升可维护性</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    include       mime.types</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 每条指令以;(分号)结尾，指令与参数之间以空格分隔</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    default_type  application/octet-stream</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    sendfile        on</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    keepalive_timeout  </span><span class="token number">65</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    server </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        listen       </span><span class="token number">80</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        server_name  localhost</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 有些指令可以支持正则表达式</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        location / </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            root   html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            index  index.html index.htm</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        error_page   </span><span class="token number">500</span><span class="token plain"> </span><span class="token number">502</span><span class="token plain"> </span><span class="token number">503</span><span class="token plain"> </span><span class="token number">504</span><span class="token plain">  /50x.html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        location </span><span class="token operator">=</span><span class="token plain"> /50x.html </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            root   html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span></div></pre></div><h3 id="全局配置"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#全局配置"><span class="icon icon-link"></span></a><code>全局配置</code></h3><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">分类</th><th align="left">配置项</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">全局</td><td align="left">user</td><td align="left">设置 nginx 服务的系统使用用户</td></tr><tr><td align="left">全局</td><td align="left">worker_processes</td><td align="left">工作进程数,一般和 CPU 数量相同</td></tr><tr><td align="left">全局</td><td align="left">error_log</td><td align="left">nginx 的错误日志</td></tr><tr><td align="left">全局</td><td align="left">pid</td><td align="left">nginx 服务启动时的 pid</td></tr></tbody></table></div></div><h3 id="事件配置"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#事件配置"><span class="icon icon-link"></span></a><code>事件配置</code></h3><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">分类</th><th align="left">配置项</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">events</td><td align="left">worker_connections</td><td align="left">每个进程允许的最大连接数 10000</td></tr><tr><td align="left">events</td><td align="left">use</td><td align="left">指定使用哪种模型(select/poll/epoll),建议让 nginx 自动选择,linux 内核 2.6 以上一般能使用 epoll 可以提高性能</td></tr></tbody></table></div></div><h3 id="http配置"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#http配置"><span class="icon icon-link"></span></a><code>http配置</code></h3><ul><li>/etc/nginx/nginx.conf</li><li>一个 HTTP 下面可以配置多个 server</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">user  nginx</span><span class="token punctuation">;</span><span class="token plain">   设置nginx服务的系统使用用户</span></div><div class="token-line"><span class="token plain">worker_processes  </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain">  工作进程数,一般和CPU数量相同</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">error_log  /var/log/nginx/error.log warn</span><span class="token punctuation">;</span><span class="token plain">   nginx的错误日志</span></div><div class="token-line"><span class="token plain">pid        /var/run/nginx.pid</span><span class="token punctuation">;</span><span class="token plain">   nginx服务启动时的pid</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">events </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    worker_connections  </span><span class="token number">1024</span><span class="token punctuation">;</span><span class="token plain">每个进程允许的最大连接数 </span><span class="token number">10000</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">http </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    include       /etc/nginx/mime.types</span><span class="token punctuation">;</span><span class="token plain">//文件后缀和类型类型的对应关系</span></div><div class="token-line"><span class="token plain">    default_type  application/octet-stream</span><span class="token punctuation">;</span><span class="token plain">//默认content-type</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    log_format  main  </span><span class="token string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                      </span><span class="token string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                      </span><span class="token string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span><span class="token punctuation">;</span><span class="token plain">  //日志记录格式</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    access_log  /var/log/nginx/access.log  main</span><span class="token punctuation">;</span><span class="token plain">//默认访问日志</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    sendfile        on</span><span class="token punctuation">;</span><span class="token plain">//启用sendfile</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#tcp_nopush     on;//懒发送</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    keepalive_timeout  </span><span class="token number">65</span><span class="token punctuation">;</span><span class="token plain">//超时时间是65秒</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#gzip  on; # 启用gzip压缩</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    include /etc/nginx/conf.d/*.conf</span><span class="token punctuation">;</span><span class="token plain">//包含的子配置文件</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h3 id="server"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#server"><span class="icon icon-link"></span></a><code>server</code></h3><ul><li>/etc/nginx/conf.d/default.conf</li><li>一个 server 下面可以配置多个 location</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">server </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    listen       </span><span class="token number">80</span><span class="token punctuation">;</span><span class="token plain">  //监听的端口号</span></div><div class="token-line"><span class="token plain">    server_name  localhost</span><span class="token punctuation">;</span><span class="token plain">  //用域名方式访问的地址</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#charset koi8-r; //编码</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#access_log  /var/log/nginx/host.access.log  main;//访问日志文件和名称</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    location / </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        root   /usr/share/nginx/html</span><span class="token punctuation">;</span><span class="token plain">  //静态文件根目录</span></div><div class="token-line"><span class="token plain">        index  index.html index.htm</span><span class="token punctuation">;</span><span class="token plain">  //首页的索引文件</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">#error_page  404              /404.html;  //指定错误页面</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment"># redirect server error pages to the static page /50x.html</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment"># 把后台错误重定向到静态的50x.html页面</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    error_page   </span><span class="token number">500</span><span class="token plain"> </span><span class="token number">502</span><span class="token plain"> </span><span class="token number">503</span><span class="token plain"> </span><span class="token number">504</span><span class="token plain">  /50x.html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    location </span><span class="token operator">=</span><span class="token plain"> /50x.html </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        root   /usr/share/nginx/html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h3 id="systemd"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#systemd"><span class="icon icon-link"></span></a><code>Systemd</code></h3><ul><li>系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其他进程，根据管理，字母 d 是守护进程（daemon）的缩写</li></ul><p><code>1. 配置目录</code></p><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">配置目录</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">/usr/lib/systemd/system</td><td align="left">每个服务最主要的启动脚本设置，类似于之前的/etc/initd.d</td></tr><tr><td align="left">/run/system/system</td><td align="left">系统执行过程中所产生的服务脚本，比上面的目录优先运行</td></tr><tr><td align="left">/etc/system/system</td><td align="left">管理员建立的执行脚本，类似于/etc/rc.d/rcN.d/Sxx 类的功能，比上面目录优先运行，在三者之中，此目录优先级最高</td></tr></tbody></table></div></div><p><code>2. systemctl</code></p><ul><li>监视和控制 systemd 的主要命令是 systemctl</li><li>该命令可用于查看系统状态和管理系统及服务</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">命令：systemctl  </span><span class="token builtin class-name">command</span><span class="token plain"> name.service</span></div><div class="token-line"><span class="token plain">启动：service name start –</span><span class="token operator">&gt;</span><span class="token plain">systemctl start name.service</span></div><div class="token-line"><span class="token plain">停止：service name stop –</span><span class="token operator">&gt;</span><span class="token plain">systemctl stop name.service</span></div><div class="token-line"><span class="token plain">重启：service name restart–</span><span class="token operator">&gt;</span><span class="token plain">systemctl restart name.service</span></div><div class="token-line"><span class="token plain">状态：service name status–</span><span class="token operator">&gt;</span><span class="token plain">systemctl status name.service</span></div></pre></div><h3 id="启动和重新加载"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#启动和重新加载"><span class="icon icon-link"></span></a><code>启动和重新加载</code></h3><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">systemctl restart nginx.service</span></div><div class="token-line"><span class="token plain">systemctl reload nginx.service</span></div><div class="token-line"><span class="token plain">nginx -s reload</span></div></pre></div><h3 id="日志"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#日志"><span class="icon icon-link"></span></a><code>日志</code></h3><ul><li>curl -v <a target="_blank" rel="noopener noreferrer" href="http://localhost/">http://localhost<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><p><code>1. 日志类型</code></p><ul><li>/var/log/nginx/access.log 访问日志</li><li>/var/log/nginx/error.log 错误日志</li></ul><p><code>2. log_format</code></p><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">类型</th><th align="left">用法</th></tr></thead><tbody><tr><td align="left">语法</td><td align="left">log_format name [escape=default[json] string]</td></tr><tr><td align="left">默认</td><td align="left">log_format combined &quot; &quot;</td></tr><tr><td align="left">Context</td><td align="left">http</td></tr></tbody></table></div></div><ul><li>内置变量</li></ul><p><a target="_blank" rel="noopener noreferrer" href="http://nginx.org/en/docs/http/ngx_http_log_module.html">ngx_http_log_module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a target="_blank" rel="noopener noreferrer" href="http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format">log_format<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">名称</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">$remote_addr</td><td align="left">客户端地址</td></tr><tr><td align="left">$remote_user</td><td align="left">客户端用户名称</td></tr><tr><td align="left">$time_local</td><td align="left">访问时间和时区</td></tr><tr><td align="left">$request</td><td align="left">请求行</td></tr><tr><td align="left">$status</td><td align="left">HTTP 请求状态</td></tr><tr><td align="left">$body_bytes_sent</td><td align="left">发送给客户端文件内容大小</td></tr></tbody></table></div></div><ul><li>HTTP 请求变量<ul><li>注意要把-转成下划线,比如 User-Agent 对应于$http_user_agent</li></ul></li></ul><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">名称</th><th align="left">含义</th><th align="left">例子</th></tr></thead><tbody><tr><td align="left">arg_PARAMETER</td><td align="left">请求参数</td><td align="left">$arg_name</td></tr><tr><td align="left">http_HEADER</td><td align="left">请求头</td><td align="left"><span class="math math-inline"><mjx-container className="MathJax" jax="SVG"><svg style="vertical-align:-0.464ex" xmlns="http://www.w3.org/2000/svg" width="11.432ex" height="2.059ex" role="img" focusable="false" viewBox="0 -705 5052.9 910" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-1-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-1-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path><path id="MJX-1-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path id="MJX-1-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(576,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(937,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="msub" transform="translate(1298,0)"><g data-mml-node="mi"><use data-c="1D45D" xlink:href="#MJX-1-TEX-I-1D45D"></use></g><g data-mml-node="mi" transform="translate(536,-150) scale(0.707)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g></g><g data-mml-node="mi" transform="translate(2202.9,0)"><use data-c="1D452" xlink:href="#MJX-1-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(2668.9,0)"><use data-c="1D453" xlink:href="#MJX-1-TEX-I-1D453"></use></g><g data-mml-node="mi" transform="translate(3218.9,0)"><use data-c="1D452" xlink:href="#MJX-1-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(3684.9,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(4135.9,0)"><use data-c="1D452" xlink:href="#MJX-1-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(4601.9,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g></g></g></svg></mjx-container></span>http_host <span class="math math-inline"><mjx-container className="MathJax" jax="SVG"><svg style="vertical-align:-0.464ex" xmlns="http://www.w3.org/2000/svg" width="13.655ex" height="2.034ex" role="img" focusable="false" viewBox="0 -694 6035.5 899" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-2-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-2-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-2-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path><path id="MJX-2-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-2-TEX-I-1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path id="MJX-2-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path id="MJX-2-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-2-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-2-TEX-I-1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path id="MJX-2-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-2-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(576,0)"><use data-c="1D461" xlink:href="#MJX-2-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(937,0)"><use data-c="1D461" xlink:href="#MJX-2-TEX-I-1D461"></use></g><g data-mml-node="msub" transform="translate(1298,0)"><g data-mml-node="mi"><use data-c="1D45D" xlink:href="#MJX-2-TEX-I-1D45D"></use></g><g data-mml-node="mi" transform="translate(536,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-2-TEX-I-1D462"></use></g></g><g data-mml-node="mi" transform="translate(2288.5,0)"><use data-c="1D460" xlink:href="#MJX-2-TEX-I-1D460"></use></g><g data-mml-node="mi" transform="translate(2757.5,0)"><use data-c="1D452" xlink:href="#MJX-2-TEX-I-1D452"></use></g><g data-mml-node="msub" transform="translate(3223.5,0)"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-2-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(484,-150) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-2-TEX-I-1D44E"></use></g></g><g data-mml-node="mi" transform="translate(4131.5,0)"><use data-c="1D454" xlink:href="#MJX-2-TEX-I-1D454"></use></g><g data-mml-node="mi" transform="translate(4608.5,0)"><use data-c="1D452" xlink:href="#MJX-2-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(5074.5,0)"><use data-c="1D45B" xlink:href="#MJX-2-TEX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(5674.5,0)"><use data-c="1D461" xlink:href="#MJX-2-TEX-I-1D461"></use></g></g></g></svg></mjx-container></span>http_x_forwarded_for(代理过程)</td></tr><tr><td align="left">sent_http_HEADER</td><td align="left">响应头</td><td align="left">sent_http_cookie</td></tr></tbody></table></div></div><blockquote><p>IP1-&gt;IP2(代理)-&gt;IP3 会记录 IP 地址的代理过程,</p><ul><li>http_x_forwarded_for=Client IP,Proxy(1) IP,Proxy(2) IP</li></ul></blockquote><p><code>3, 示例</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 定义一种日志格式</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> log_format  main  </span><span class="token string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                      </span><span class="token string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                      </span><span class="token string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"> log_format  zfpx  </span><span class="token string">&#x27;$arg_name $http_referer sent_http_date&quot;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> </span><span class="token comment"># 指定写入的文件名和日志格式</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> access_log  /var/log/nginx/access.log  main</span><span class="token punctuation">;</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">tail</span><span class="token plain"> -f /var/log/nginx/access.log</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token number">221.216</span><span class="token plain">.143.110 - - </span><span class="token punctuation">[</span><span class="token plain">09/Jun/2018:22:41:18 +0800</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token string">&quot;GET / HTTP/1.1&quot;</span><span class="token plain"> </span><span class="token number">200</span><span class="token plain"> </span><span class="token number">612</span><span class="token plain"> </span><span class="token string">&quot;-&quot;</span><span class="token plain"> </span><span class="token string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36&quot;</span><span class="token plain"> </span><span class="token string">&quot;-&quot;</span></div></pre></div><h2 id="nginx工作流"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#nginx工作流"><span class="icon icon-link"></span></a><code>nginx工作流</code></h2><h3 id="配置块"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#配置块"><span class="icon icon-link"></span></a><code>配置块</code></h3><ul><li>请求到来时先按域名找到 server 块</li><li>再按请求路径找到 location 块</li><li>Context 是指本指令出现在哪个块内</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">main</span></div><div class="token-line"><span class="token plain">http</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    upstream </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    server </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function-name function">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        location</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        location</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            location</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    server</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h3 id="值指令继承规则"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#值指令继承规则"><span class="icon icon-link"></span></a><code>值指令继承规则</code></h3><ul><li>值指令可以合并，动作类指令不可以合并</li><li>值指令是向上覆盖的，子配置不存在，可以使用父配置块的指令，如果子指令存在，会覆盖父配置块中的指令</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">server </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    listen </span><span class="token number">80</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    root /home/nginx/html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    access_log logs/access.log main</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    location /image</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       access_log logs/access.log image</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    location /video</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h3 id="server匹配"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#server匹配"><span class="icon icon-link"></span></a><code>server匹配</code></h3><ul><li>精确匹配</li><li>*在前</li><li>*在后</li><li>按文件中的顺序匹配正则式域名</li><li>default server</li></ul><h3 id="http请求处理"><a aria-hidden="true" tabindex="-1" href="/operation-maintenance/nginx/base#http请求处理"><span class="icon icon-link"></span></a><code>HTTP请求处理</code></h3><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th align="left">阶段</th><th align="left">名称</th><th align="left">对应模块</th></tr></thead><tbody><tr><td align="left">读取请求后</td><td align="left">POST_READ</td><td align="left">realip</td></tr><tr><td align="left">重写</td><td align="left">SERVER_REWRITE</td><td align="left">rewrite</td></tr><tr><td align="left">匹配 location</td><td align="left">FIND_CONFIG</td><td align="left">rewrite</td></tr><tr><td align="left">重写</td><td align="left">REWRITE</td><td align="left">rewrite</td></tr><tr><td align="left">重写后</td><td align="left">POST_REWRITE</td><td align="left"></td></tr><tr><td align="left">访问前限制</td><td align="left">PREACCESS</td><td align="left">limit_conn,limit_req</td></tr><tr><td align="left">是否有权限访问</td><td align="left">ACCESS</td><td align="left">auth_basic,access,auth_request</td></tr><tr><td align="left">判断权限后</td><td align="left">POST_ACCESS</td><td align="left"></td></tr><tr><td align="left">响应前</td><td align="left">PRECONTENT</td><td align="left">try_files</td></tr><tr><td align="left">生成响应内容</td><td align="left">CONTENT</td><td align="left">index,autoindex,concat</td></tr><tr><td align="left">打印日志</td><td align="left">LOG</td><td align="left">access_log</td></tr></tbody></table></div></div><p><img src="/images/nginx/nginx_http_request_process.jpeg" alt="nginx_http_request_process"/></p><p>上面的图片 访问控制之前，还有一个 匹配 location 的流程</p><style>
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}
</style></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last update: ">3/1/2023 14:23:32</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.js"></script>
  </body>
</html>
